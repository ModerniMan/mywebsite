<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××—×•×œ×œ ×™×“×™×“×™× - ×§×¨×™×•×ª (××¢×¨×›×ª ××©×•×œ×‘×ª)</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            /* Palette */
            --c-blue-dark: #2c6da6;
            --c-blue-light: #e3f2fd;
            --c-gold: #ffd700;
            --c-orange: #fbc02d;
            --c-red: #ef5350;
            --c-cyan: #80deea;

            --c-text-main: #37474f;
            --c-text-muted: #78909c;
            --c-warning: #d32f2f;

            /* Graph Colors */
            --g-hanaa: #29b6f6;
            --g-pancer: #ffa726;
            --g-locked: #ff7043;
            --ring-blue: #42a5f5;
            --ring-green: #66bb6a;
            --ring-orange: #ffa726;
        }

        body {
            font-family: 'Assistant', sans-serif;
            background-color: #cfd8dc;
            margin: 0;
            display: flex;
            height: 100vh;
            color: var(--c-text-main);
            overflow: hidden;
        }

        /* --- Sidebar (Editor) --- */
        .sidebar {
            width: 360px;
            background: #ffffff;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 100;
            overflow-y: auto;
            border-left: 1px solid #dee2e6;
        }

        .sidebar h2 {
            margin: 0 0 10px 0;
            color: var(--c-blue-dark);
            font-size: 26px;
            font-weight: 800;
            text-align: center;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            background: #f1f3f5;
            padding: 4px;
            border-radius: 8px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            color: #78909c;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: #fff;
            color: var(--c-blue-dark);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .section-label {
            font-size: 14px;
            font-weight: 700;
            color: var(--c-blue-dark);
            margin-top: 15px;
            margin-bottom: 5px;
            border-bottom: 2px solid #edf2f7;
            padding-bottom: 2px;
        }

        .input-row {
            display: flex;
            gap: 10px;
        }

        .input-group {
            flex: 1;
        }

        .input-group label {
            font-size: 12px;
            font-weight: 600;
            color: var(--c-text-muted);
            display: block;
            margin-bottom: 4px;
        }

        .input-group input,
        .input-group textarea,
        textarea,
        input[type="text"],
        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #cfd8dc;
            border-radius: 6px;
            font-family: inherit;
            font-weight: 600;
            text-align: center;
            box-sizing: border-box;
            background: #f8f9fa;
            transition: all 0.2s;
        }

        textarea {
            text-align: right;
            resize: vertical;
            min-height: 100px;
            font-weight: normal;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--c-blue-dark);
            background: #fff;
        }

        .smart-paste-area {
            background: #e8f5e9 !important;
            border: 1px dashed #66bb6a !important;
        }

        .download-btn {
            background: linear-gradient(135deg, var(--c-blue-dark), #1e549f);
            color: white;
            font-weight: 800;
            padding: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            margin-top: auto;
            width: 100%;
            box-shadow: 0 4px 10px rgba(30, 84, 159, 0.3);
            transition: transform 0.1s;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(30, 84, 159, 0.4);
        }

        .download-btn:active {
            transform: translateY(0);
        }

        /* --- Preview Area --- */
        .preview-area {
            flex: 1;
            background-color: #263238;
            background-image:
                linear-gradient(45deg, #37474f 25%, transparent 25%, transparent 75%, #37474f 75%, #37474f),
                linear-gradient(45deg, #37474f 25%, transparent 25%, transparent 75%, #37474f 75%, #37474f);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            overflow: auto;
        }

        /* Shared Card Styles */
        .main-card {
            position: relative;
            z-index: 10;
            background: rgba(255, 255, 255, 0.96);
            margin: 25px;
            height: auto;
            min-height: calc(100% - 50px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            /* flex by default, toggled via JS */
            flex-direction: column;
            border-radius: 8px;
            overflow: visible;
        }

        #card-stats {
            width: 500px;
        }

        #card-welcome {
            width: 500px;
            min-height: 600px;
            display: none;
        }

        /* --- Header Section (Shared) --- */
        .header-section {
            background: var(--c-blue-dark);
            color: #fff;
            padding: 30px 0 20px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-radius: 8px 8px 0 0;
        }

        .header-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 40%, rgba(255, 255, 255, 0.1) 50%, transparent 60%);
        }

        .header-section h1 {
            font-size: 42px;
            margin: 0;
            font-weight: 800;
            line-height: 1.1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header-section span,
        .header-section h2,
        .header-section h3 {
            display: block;
            margin-top: 5px;
            font-size: 20px;
            font-weight: 300;
            opacity: 0.95;
            color: inherit;
        }

        /* --- Map Overlay (Shared) --- */
        .map-layer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f0f4f8;
            opacity: 1;
            z-index: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M54.627 0l.83.828-1.415 1.415-.828-.828-.828.828-1.415-1.415.828-.828-.828-.828 1.415-1.415.828-.828-.828-.828 1.415 1.415-.828.828zM22.485 0l.83.828-1.415 1.415-.828-.828-.828.828-1.415-1.415.828-.828-.828-.828 1.415-1.415.828-.828-.828-.828 1.415 1.415-.828.828zM0 22.485l.828.83-1.415 1.415-.828-.828-.828.828L-2.83 22.485l.828-.828-.828-.828 1.415-1.415.828.828.828-.828 1.415 1.415-.828.828.828-.828 1.415-1.415-.828.828z' fill='%23cfd8dc' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E");
            background-size: 100px 100px;
        }

        .map-layer::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3z' fill='%23b0bec5' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.6;
        }

        /* --- Stats Specific Styles --- */
        .card-body {
            padding: 20px 30px;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card-heading {
            text-align: center;
            font-size: 18px;
            font-weight: 800;
            color: var(--c-text-main);
            margin-bottom: 15px;
            position: relative;
        }

        .card-heading::after {
            content: '';
            display: block;
            width: 40px;
            height: 3px;
            background: var(--c-blue-dark);
            margin: 5px auto 0;
            border-radius: 2px;
        }

        .stats-row {
            display: flex;
            justify-content: space-around;
            padding: 20px 0;
            background: #fcfcfc;
            border-radius: 12px;
            border: 1px solid #f0f0f0;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .stat-circle {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            border: 8px solid #eee;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            font-weight: 900;
            color: #455a64;
            background: #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-label {
            font-size: 16px;
            font-weight: 800;
            color: #546e7a;
        }

        .graph-container {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-end;
            gap: 15px;
            height: 180px;
            margin-top: 10px;
            padding: 0 10px;
        }

        .graph-col {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            gap: 6px;
            width: 45px;
            height: 100%;
            transition: all 0.3s;
        }

        .g-val {
            font-size: 14px;
            font-weight: 800;
            color: #455a64;
            text-align: center;
        }

        .g-track {
            width: 14px;
            height: 100%;
            background: #eceff1;
            border-radius: 10px;
            position: relative;
            display: flex;
            align-items: flex-end;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .g-bar {
            width: 100%;
            border-radius: 10px;
            transition: height 0.8s cubic-bezier(0.22, 1, 0.36, 1);
            position: relative;
            min-height: 4px;
        }

        .bar-hanaa {
            background: #29b6f6;
        }

        .bar-pancer {
            background: #ffa726;
        }

        .bar-locked {
            background: #ff7043;
        }

        .bar-other {
            background: #8d6e63;
        }

        .bar-fuel {
            background: #7e57c2;
        }

        .bar-door {
            background: #ab47bc;
        }

        .bar-transport {
            background: #26a69a;
        }

        .bar-war {
            background: #5c6bc0;
        }

        .g-label {
            font-size: 11px;
            font-weight: 700;
            text-align: center;
            color: #546e7a;
            white-space: normal;
            line-height: 1.1;
            overflow: visible;
            width: 100%;
        }

        /* Podium Area */
        .excellence-container {
            display: flex;
            flex-direction: row-reverse;
            justify-content: center;
            align-items: flex-end;
            margin-top: 25px;
            padding: 20px 5px;
            gap: 15px;
            background: linear-gradient(to bottom, #ffffff, #f0f4f8);
            border-radius: 16px;
            border: 1px solid #dae1e7;
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.7);
        }

        .podium-wrapper {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 2px;
            perspective: 500px;
        }

        .podium-col {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 72px;
            position: relative;
            z-index: 1;
        }

        .p-avatar {
            font-size: 13px;
            font-weight: 800;
            color: #263238;
            text-align: center;
            margin-bottom: 6px;
            line-height: 1.1;
            min-height: 35px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            text-shadow: 0 1px 0 #fff;
        }

        .p-block {
            width: 100%;
            border: none;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 8px;
            position: relative;
            border-radius: 6px 6px 0 0;
            box-shadow: inset 0 2px 0 rgba(255, 255, 255, 0.3), inset 0 -10px 20px rgba(0, 0, 0, 0.05), 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .rank-num {
            font-size: 24px;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .medal-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #ffd700;
            border: 2px solid #fff;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
            position: absolute;
            top: 22px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5;
        }

        .medal-icon::before {
            content: '';
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 20px;
            border-left: 3px solid #d32f2f;
            border-right: 3px solid #d32f2f;
            z-index: -1;
        }

        .place-2 .p-block {
            height: 75px;
            background: linear-gradient(135deg, #64b5f6, #42a5f5);
            z-index: 2;
        }

        .place-2 .medal-icon {
            background: linear-gradient(135deg, #e0e0e0, #eeeeee);
            border-color: #fff;
        }

        .place-1 .p-block {
            height: 100px;
            background: linear-gradient(135deg, #81c784, #66bb6a);
            z-index: 3;
            box-shadow: 0 10px 20px rgba(102, 187, 106, 0.3), inset 0 2px 0 rgba(255, 255, 255, 0.4);
            transform: scale(1.05);
            transform-origin: bottom;
        }

        .place-1 .medal-icon {
            background: linear-gradient(135deg, #ffd54f, #ffca28);
            width: 40px;
            height: 40px;
            top: 18px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .place-1 .p-avatar {
            font-size: 15px;
            color: #1b5e20;
            margin-bottom: 8px;
        }

        .place-3 .p-block {
            height: 55px;
            background: linear-gradient(135deg, #7986cb, #5c6bc0);
            z-index: 1;
        }

        .place-3 .medal-icon {
            background: linear-gradient(135deg, #d7ccc8, #bcaaa4);
        }

        .badge-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .certificate-box {
            background: linear-gradient(135deg, #ffffff 0%, #fffde7 100%);
            border: 1px solid #ffd54f;
            padding: 12px 0;
            text-align: center;
            border-radius: 12px;
            box-shadow: 0 8px 15px rgba(255, 193, 7, 0.15);
            position: relative;
            width: 120px;
            transform: rotate(-2deg);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .certificate-box::after {
            content: '';
            position: absolute;
            top: 4px;
            left: 4px;
            right: 4px;
            bottom: 4px;
            border: 1px dashed #ffe082;
            border-radius: 8px;
            pointer-events: none;
        }

        .c-star {
            font-size: 36px;
            margin-bottom: 2px;
            filter: drop-shadow(0 3px 3px rgba(0, 0, 0, 0.15));
            line-height: 1;
        }

        .c-title {
            font-size: 11px;
            font-weight: 800;
            color: #546e7a;
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 2;
        }

        .c-name {
            font-size: 16px;
            font-weight: 900;
            color: #e65100;
            line-height: 1.1;
            margin-bottom: 4px;
            position: relative;
            z-index: 2;
        }

        .c-sub {
            font-size: 10px;
            color: #90a4ae;
            line-height: 1.1;
            position: relative;
            z-index: 2;
        }

        /* --- Welcome Specific Styles --- */
        .welcome-content {
            padding: 30px;
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: radial-gradient(circle at center, #ffffff 0%, #f5f7fa 100%);
            border-radius: 0 0 8px 8px;
        }

        .welcome-title {
            font-size: 24px;
            font-weight: 800;
            color: var(--c-blue-dark);
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 3px solid var(--c-gold);
            padding-bottom: 5px;
            display: inline-block;
        }

        .volunteers-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
            margin-bottom: 30px;
        }

        .v-item {
            background: #fff;
            padding: 12px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border-right: 4px solid var(--c-blue-dark);
            font-size: 18px;
            font-weight: 700;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: transform 0.2s;
        }

        .v-item:hover {
            transform: scale(1.02);
        }

        .footer-rules {
            margin-top: auto;
            background: #ffebee;
            border: 1px dashed var(--c-warning);
            padding: 15px;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
            text-align: center;
        }

        .rule-item {
            font-size: 14px;
            color: #c62828;
            margin: 4px 0;
            font-weight: 600;
        }

        .rule-bold {
            font-weight: 800;
            font-size: 15px;
        }

        /* Utils */
        .hidden {
            display: none !important;
        }

        .card-footer {
            margin-top: auto;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: #b0bec5;
            padding-top: 10px;
        }

        .w-header-bg {
            /* Override header height for welcome card */
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        [contenteditable]:hover {
            outline: 1px dashed #ccc;
            cursor: text;
        }

        [contenteditable]:focus {
            outline: 2px solid #2196f3;
            background: rgba(33, 150, 243, 0.1);
        }
    </style>
</head>

<body>

    <div class="sidebar">
        <h2>×™×“×™×“×™× - ××¢×¨×›×ª ××©×•×œ×‘×ª</h2>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('stats')">ğŸ“Š ×“×•×— ×©×‘×•×¢×™</button>
            <button class="tab-btn" onclick="switchTab('welcome')">ğŸ‘‹ ×§×‘×œ×ª ×¤× ×™×</button>
        </div>

        <!-- STATS INPUTS -->
        <div id="inputs-stats">
            <div class="section-label">× ×ª×•× ×™× ×›×œ×œ×™×™×</div>
            <div class="input-row">
                <div class="input-group"><label>×§×¨×™××•×ª ×¡×”"×›</label><input type="number" id="in-total" value=""
                        oninput="renderStats()"></div>
                <div class="input-group"><label>××ª× ×“×‘×™×</label><input type="number" id="in-vols" value=""
                        oninput="renderStats()"></div>
                <div class="input-group"><label>×—×™×¨×•×</label><input type="number" id="in-emer" value=""
                        oninput="renderStats()"></div>
            </div>

            <div class="section-label">×”×ª×¤×œ×’×•×ª ××™×¨×•×¢×™×</div>
            <div class="input-row">
                <div class="input-group"><label>×”× ×¢×”</label><input type="number" id="in-hanaa" value=""
                        oninput="renderStats()"></div>
                <div class="input-group"><label>×¤× ×¦'×¨</label><input type="number" id="in-pancer" value=""
                        oninput="renderStats()"></div>
                <div class="input-group"><label>×¨×›×‘ × ×¢×•×œ</label><input type="number" id="in-locked" value=""
                        oninput="renderStats()"></div>
            </div>
            <div class="input-row" style="margin-top:10px;">
                <div class="input-group"><label>×©××Ÿ/××™×/×“×œ×§</label><input type="number" id="in-fuel" value=""
                        oninput="renderStats()"></div>
                <div class="input-group"><label>×“×œ×ª ×˜×¨×•×§×”</label><input type="number" id="in-door" value=""
                        oninput="renderStats()"></div>
                <div class="input-group"><label>×©×™× ×•×¢</label><input type="number" id="in-transport" value=""
                        oninput="renderStats()"></div>
            </div>
            <div class="input-row" style="margin-top:10px;">
                <div class="input-group"><label>×–××Ÿ ×œ×—×™××”</label><input type="number" id="in-war" value=""
                        oninput="renderStats()"></div>
                <div class="input-group"><label>××—×¨</label><input type="number" id="in-other" value=""
                        oninput="renderStats()"></div>
            </div>

            <div class="section-label">×¨×©×™××ª ××ª× ×“×‘×™× (×œ×¤×•×“×™×•×)</div>
            <div class="input-group">
                <textarea id="in-list-stats" class="smart-paste-area" oninput="renderStats()"
                    placeholder="×”×“×‘×§ ×©××•×ª ×•××¡×¤×¨×™×..."></textarea>
            </div>

            <div class="input-group" style="margin-top: 10px;">
                <label>×‘×—×™×¨×ª ××¦×˜×™×™×Ÿ ×™×“× ×™×ª (×”×§×œ×“ ×©×)</label>
                <input type="text" id="in-star-select" list="star-options" oninput="renderStats(true)"
                    placeholder="×”×ª×—×œ ×œ×”×§×œ×™×“...">
                <datalist id="star-options"></datalist>
            </div>
        </div>

        <!-- WELCOME INPUTS -->
        <div id="inputs-welcome" class="hidden">
            <div class="section-label">×›×•×ª×¨×•×ª</div>
            <input type="text" id="in-w-org" value="×™×“×™×“×™× ×¡×™×•×¢ ×‘×“×¨×›×™×" oninput="renderWelcome()">
            <input type="text" id="in-w-district" value="××—×•×– ×¦×¤×•×Ÿ - ×¡× ×™×£ ×§×¨×™×•×ª" oninput="renderWelcome()">
            <input type="text" id="in-w-sub" value="×‘×¨×•×›×™× ×”×‘××™× ×œ×¤×•×¨×•× ×”×¡× ×™×£:" oninput="renderWelcome()"
                placeholder="×›×•×ª×¨×ª ××©× ×”...">

            <div class="section-label">×©××•×ª ××ª× ×“×‘×™× (×—×“×©×™×)</div>
            <textarea id="in-w-names" oninput="renderWelcome()" placeholder="×”×›× ×¡ ×©××•×ª..."></textarea>

            <div class="section-label">×”×•×“×¢×” ×¨××©×™×ª</div>
            <input type="text" id="in-w-msg" value="â¤ï¸×‘×¨×•×›×™× ×”×‘××™×â¤ï¸" oninput="renderWelcome()">

            <div class="section-label">×›×œ×œ×™×</div>
            <textarea id="in-w-rules" oninput="renderWelcome()" style="height:150px;">×§×‘×•×¦×” ×–×• ×”×™× *×§×‘×•×¦×ª ×”×¤×•×¨×•×* ×©×œ *××œ×•×¤×™ ×§×¨×™×•×ª* ×”×’×™×‘×•×¨×™× 

×”×§×‘×•×¦×” ×¤×¢×™×œ×” *×©×©×” ×™××™× ×‘×©×‘×•×¢ ×›×•×œ×œ ×‘×œ×™×œ×”*.

× ×™×ª×Ÿ ×œ×©×ª×£, ×œ×”×ª×™×™×¢×¥, ×œ×¦×—×•×§ ×•×”×›×™ ×—×©×•×‘ , ×œ×”×™×•×ª ×××•×—×“×™× ,  ×‘×™×—×“ğŸ’ªğŸ¼</textarea>
        </div>

        <button class="download-btn" onclick="downloadImage()">×©××•×¨ ×ª××•× ×” ×œ×”×¤×¦×” ğŸ“¥</button>
    </div>

    <div class="preview-area">
        <div id="canvas-container">
            <!-- Background Map Layer (Shared) -->
            <div class="map-layer"></div>

            <!-- CARD 1: STATS -->
            <div id="card-stats" class="main-card">
                <div class="header-section">
                    <h1 contenteditable="true">×™×“×™×“×™× ×¡× ×™×£ ×§×¨×™×•×ª</h1>
                    <span contenteditable="true">×¡×™×›×•× ×©×‘×•×¢×™ | ××—×•×– ×¦×¤×•×Ÿ</span>
                </div>

                <div class="card-body">
                    <!-- Stats Rows -->
                    <div class="stats-row">
                        <div class="stat-item">
                            <div class="stat-circle" style="border-color: var(--ring-blue);">
                                <div id="out-total">0</div>
                            </div>
                            <div class="stat-label">ğŸ“ ×§×¨×™××•×ª ×¡×”"×›</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-circle" style="border-color: var(--ring-green);">
                                <div id="out-vols">0</div>
                            </div>
                            <div class="stat-label">ğŸ§¡ ××ª× ×“×‘×™×</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-circle" style="border-color: var(--ring-orange);">
                                <div id="out-emer">0</div>
                            </div>
                            <div class="stat-label">ğŸš¨ ×§×¨×™××•×ª ×—×™×¨×•×</div>
                        </div>
                    </div>

                    <!-- Graphs -->
                    <div class="card-heading" contenteditable="true">×”×ª×¤×œ×’×•×ª ×¡×•×’×™ ×”×§×¨×™××•×ª</div>
                    <div class="graph-container">
                        <!-- Cols injected/managed via IDs -->
                        <div class="graph-col" id="col-hanaa">
                            <div class="g-val" id="txt-hanaa">0</div>
                            <div class="g-track">
                                <div class="g-bar bar-hanaa" id="bar-hanaa" style="height:0%;"></div>
                            </div>
                            <div class="g-label">âš¡ ×”× ×¢×”</div>
                        </div>
                        <div class="graph-col" id="col-pancer">
                            <div class="g-val" id="txt-pancer">0</div>
                            <div class="g-track">
                                <div class="g-bar bar-pancer" id="bar-pancer" style="height:0%;"></div>
                            </div>
                            <div class="g-label">ğŸ› ×¤× ×¦'×¨</div>
                        </div>
                        <div class="graph-col" id="col-locked">
                            <div class="g-val" id="txt-locked">0</div>
                            <div class="g-track">
                                <div class="g-bar bar-locked" id="bar-locked" style="height:0%;"></div>
                            </div>
                            <div class="g-label">ğŸ” ×¨×›×‘ × ×¢×•×œ</div>
                        </div>
                        <div class="graph-col" id="col-fuel">
                            <div class="g-val" id="txt-fuel">0</div>
                            <div class="g-track">
                                <div class="g-bar bar-fuel" id="bar-fuel" style="height:0%;"></div>
                            </div>
                            <div class="g-label">â›½ ×©××Ÿ/××™×/×“×œ×§</div>
                        </div>
                        <div class="graph-col" id="col-door">
                            <div class="g-val" id="txt-door">0</div>
                            <div class="g-track">
                                <div class="g-bar bar-door" id="bar-door" style="height:0%;"></div>
                            </div>
                            <div class="g-label">ğŸšª ×“×œ×ª ×˜×¨×•×§×”</div>
                        </div>
                        <div class="graph-col" id="col-transport">
                            <div class="g-val" id="txt-transport">0</div>
                            <div class="g-track">
                                <div class="g-bar bar-transport" id="bar-transport" style="height:0%;"></div>
                            </div>
                            <div class="g-label">ğŸ“¦ ×©×™× ×•×¢</div>
                        </div>
                        <div class="graph-col" id="col-war">
                            <div class="g-val" id="txt-war">0</div>
                            <div class="g-track">
                                <div class="g-bar bar-war" id="bar-war" style="height:0%;"></div>
                            </div>
                            <div class="g-label">âš”ï¸ ×–××Ÿ ×œ×—×™××”</div>
                        </div>
                        <div class="graph-col" id="col-other">
                            <div class="g-val" id="txt-other">0</div>
                            <div class="g-track">
                                <div class="g-bar bar-other" id="bar-other" style="height:0%;"></div>
                            </div>
                            <div class="g-label">ğŸ¤·â€â™‚ï¸ ××—×¨</div>
                        </div>
                    </div>

                    <!-- Podium -->
                    <div class="card-heading" style="margin-top: 20px;" contenteditable="true">×¤×™×¨×•×˜ ××™×¨×•×¢×™× ×•×”×¦×˜×™×™× ×•×ª
                    </div>
                    <div id="podium-area">
                        <!-- JS Injected -->
                    </div>

                    <div class="card-footer">×›×•× × ×™ ×”×§×¨×™×•×ª - ×’××•×•×” ×™×©×¨××œ×™×ª!</div>
                </div>
            </div>

            <!-- CARD 2: WELCOME -->
            <div id="card-welcome" class="main-card">
                <div class="header-section w-header-bg">
                    <div class="header-content">
                        <h1 id="out-w-org" contenteditable="true">×™×“×™×“×™× ×¡×™×•×¢ ×‘×“×¨×›×™×</h1>
                        <h2 id="out-w-district" contenteditable="true">××—×•×– ×¦×¤×•×Ÿ - ×¡× ×™×£ ×§×¨×™×•×ª</h2>
                        <h3 id="out-w-sub" contenteditable="true"
                            style="margin:5px 0 0 0; font-size:16px; font-weight:600; color:#bbdefb;">×‘×¨×•×›×™× ×”×‘××™×
                            ×œ×¤×•×¨×•× ×”×¡× ×™×£:</h3>
                    </div>
                </div>

                <div class="welcome-content">
                    <div class="welcome-title" id="out-w-msg" contenteditable="true">â¤ï¸×‘×¨×•×›×™× ×”×‘××™×â¤ï¸</div>
                    <div class="volunteers-list" id="w-list-container">
                        <!-- JS Injected -->
                    </div>
                    <div class="footer-rules" id="w-rules-container">
                        <!-- JS Injected -->
                    </div>
                </div>

                <div
                    style="height:12px; background: linear-gradient(to right, var(--c-blue-dark), var(--c-blue-light)); width:100%; border-radius: 0 0 8px 8px;">
                </div>
            </div>

        </div>
    </div>

    <script>
        let currentTab = 'stats';

        function switchTab(tab) {
            currentTab = tab;

            // Buttons
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');

            // Inputs
            document.getElementById('inputs-stats').classList.add('hidden');
            document.getElementById('inputs-welcome').classList.add('hidden');
            document.getElementById('inputs-' + tab).classList.remove('hidden');

            // Cards
            document.getElementById('card-stats').style.display = 'none';
            document.getElementById('card-welcome').style.display = 'none';
            document.getElementById('card-' + tab).style.display = 'flex';
        }

        // --- STATS LOGIC ---
        function parseNames(text) {
            const lines = text.split('\n');
            let result = [];
            lines.forEach(line => {
                let clean = line.trim();
                if (!clean) return;
                let match = clean.match(/^(.*?)[ \-\.]+(\d+)$/);
                if (match) {
                    result.push({ name: match[1].trim(), score: parseInt(match[2]) });
                }
            });
            return result.sort((a, b) => b.score - a.score);
        }

        function updateStarSelect(list) {
            const datalist = document.getElementById('star-options');
            datalist.innerHTML = '';

            list.forEach(p => {
                let opt = document.createElement('option');
                opt.value = p.name;
                datalist.appendChild(opt);
            });
        }

        function renderStats(triggeredBySelect = false) {
            // Stats
            const total = document.getElementById('in-total').value || 0;
            const vols = document.getElementById('in-vols').value || 0;
            const emer = document.getElementById('in-emer').value || 0;
            document.getElementById('out-total').innerText = total;
            document.getElementById('out-vols').innerText = vols;
            document.getElementById('out-emer').innerText = emer;

            // Graphs
            const p = parseInt(document.getElementById('in-pancer').value) || 0;
            const h = parseInt(document.getElementById('in-hanaa').value) || 0;
            const l = parseInt(document.getElementById('in-locked').value) || 0;
            const fuel = parseInt(document.getElementById('in-fuel').value) || 0;
            const door = parseInt(document.getElementById('in-door').value) || 0;
            const trans = parseInt(document.getElementById('in-transport').value) || 0;
            const war = parseInt(document.getElementById('in-war').value) || 0;
            const other = parseInt(document.getElementById('in-other').value) || 0;

            const rawMax = Math.max(p, h, l, fuel, door, trans, war, other, 1);
            const max = Math.ceil(rawMax / 10) * 10;

            const updateCol = (id, val) => {
                const col = document.getElementById('col-' + id);
                const bar = document.getElementById('bar-' + id);
                const txt = document.getElementById('txt-' + id);
                if (val > 0) {
                    col.style.display = 'flex';
                    bar.style.height = (val / max * 100) + "%";
                    txt.innerText = val;
                } else {
                    col.style.display = 'none';
                    bar.style.height = "0%";
                    txt.innerText = "0";
                }
            };

            updateCol('pancer', p); updateCol('hanaa', h); updateCol('locked', l);
            updateCol('fuel', fuel); updateCol('door', door); updateCol('transport', trans);
            updateCol('war', war); updateCol('other', other);

            // Podium Logic
            const rawText = document.getElementById('in-list-stats').value;
            let list = parseNames(rawText);

            // Populate Datalist
            if (!triggeredBySelect) {
                updateStarSelect(list);
            }

            // Check override
            const overrideName = document.getElementById('in-star-select').value;

            if (overrideName) {
                // Find and move to top
                const idx = list.findIndex(x => x.name === overrideName);
                if (idx > -1) {
                    const person = list.splice(idx, 1)[0];
                    list.unshift(person); // Move to front
                }
            }

            if (list.length === 0) list = Array(3).fill({ name: '-', score: 0 });

            const top1 = list[0] || { name: '-', score: 0 };
            const top2 = list[1] || { name: '-', score: 0 };
            const top3 = list[2] || { name: '-', score: 0 };

            document.getElementById('podium-area').innerHTML = `
                <div class="excellence-container">
                    <!-- Podium (Left Side visually, Right in DOM due to row-reverse) -->
                    <div style="text-align:center;">
                        <h3 style="margin:0 0 10px 0; color:#546e7a; font-size:14px; font-weight:700;">×”××ª× ×“×‘×™× ×”××•×‘×™×œ×™×</h3>
                        <div class="podium-wrapper">
                            <div class="podium-col place-2">
                                <div class="p-avatar" contenteditable="true">${top2.name}<br>${top2.score} ×§×¨×™××•×ª</div>
                                <div class="p-block"><div class="rank-num">2</div><div class="medal-icon"></div></div>
                            </div>
                            <div class="podium-col place-1">
                                <div class="p-avatar" contenteditable="true">${top1.name}<br>${top1.score} ×§×¨×™××•×ª</div>
                                <div class="p-block"><div class="rank-num">1</div><div class="medal-icon"></div></div>
                            </div>
                            <div class="podium-col place-3">
                                <div class="p-avatar" contenteditable="true">${top3.name}<br>${top3.score} ×§×¨×™××•×ª</div>
                                <div class="p-block"><div class="rank-num">3</div><div class="medal-icon"></div></div>
                            </div>
                        </div>
                    </div>
                    <!-- Weekly Star -->
                    <div class="badge-wrapper">
                         <div class="certificate-box">
                             <div class="c-star">â­</div>
                             <div class="c-title">××¦×˜×™×™×Ÿ ×©×‘×•×¢×™</div>
                             <div class="c-name" contenteditable="true">${top1.name}</div>
                             <div class="c-sub" contenteditable="true">×¢×œ ×ª×¨×•××” ×™×•×¦××ª ×“×•×¤×Ÿ</div>
                         </div>
                    </div>
                </div>
            `;
        }

        // --- WELCOME LOGIC ---
        function renderWelcome() {
            document.getElementById('out-w-org').innerText = document.getElementById('in-w-org').value;
            document.getElementById('out-w-district').innerText = document.getElementById('in-w-district').value;
            document.getElementById('out-w-sub').innerText = document.getElementById('in-w-sub').value;
            document.getElementById('out-w-msg').innerText = document.getElementById('in-w-msg').value;

            const namesText = document.getElementById('in-w-names').value;
            const names = namesText.split('\n').filter(n => n.trim() !== '');
            const listContainer = document.getElementById('w-list-container');
            listContainer.innerHTML = '';

            names.forEach(name => {
                let cleanName = name.replace(/\*/g, '').trim();
                let div = document.createElement('div');
                div.className = 'v-item';
                div.innerHTML = `<span class="v-icon">ğŸ‘¤</span> <div><strong>${cleanName}</strong></div>`;
                listContainer.appendChild(div);
            });

            const rulesText = document.getElementById('in-w-rules').value;
            const rulesContainer = document.getElementById('w-rules-container');
            rulesContainer.innerHTML = '';

            rulesText.split('\n').forEach(line => {
                if (!line.trim()) return;
                let div = document.createElement('div');
                div.className = 'rule-item';
                let content = line.replace(/\*(.*?)\*/g, '<span class="rule-bold">$1</span>');
                div.innerHTML = content;
                if (line.includes('×©×‘×ª')) {
                    div.style.color = '#b71c1c'; div.style.fontWeight = '800';
                    div.style.fontSize = '16px'; div.style.marginTop = '10px';
                    div.style.borderTop = '1px solid #ffccbc'; div.style.paddingTop = '5px';
                }
                rulesContainer.appendChild(div);
            });
        }

        function downloadImage() {
            // Select correct container based on tab
            let targetId = currentTab === 'stats' ? 'card-stats' : 'card-welcome';
            const element = document.getElementById(targetId);

            html2canvas(element, { scale: 2, useCORS: true, backgroundColor: null }).then(canvas => {
                let link = document.createElement("a");
                link.download = "yedidim_" + currentTab + ".png";
                link.href = canvas.toDataURL("image/png");
                link.click();
            });
        }

        // Initialize Defaults check
        // We leave defaults empty now as per user request to start clean.

        // Run Initial Renders
        renderStats();
        renderWelcome();
    </script>
</body>

</html>
